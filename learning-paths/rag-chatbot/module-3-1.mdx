---
title: "3.1 Create Embeddings Table"
description: "Create a table called embeddings to store chunks with proper indexing for similarity search."
---

## Creating the Embeddings Table

Each resource from the `resources` table will have to be chunked, embedded, and then stored in a new table called `embeddings`.

Create a new file (`lib/db/schema/embeddings.ts`) and add the following code:

```typescript lib/db/schema/embeddings.ts
import { nanoid } from "@/lib/utils";
import { index, pgTable, text, varchar, vector } from "drizzle-orm/pg-core";
import { resources } from "./resources";

export const embeddings = pgTable(
  "embeddings",
  {
    id: varchar("id", { length: 191 })
      .primaryKey()
      .$defaultFn(() => nanoid()),
    resourceId: varchar("resource_id", { length: 191 }).references(
      () => resources.id,
      { onDelete: "cascade" }
    ),
    content: text("content").notNull(),
    embedding: vector("embedding", { dimensions: 1536 }).notNull(),
  },
  (table) => ({
    embeddingIndex: index("embeddingIndex").using(
      "hnsw",
      table.embedding.op("vector_cosine_ops")
    ),
  })
);
```

---

### Structure of the `embeddings` table

This table has four columns:

<Columns cols={2}>
  <Card title="id" icon="hash">
    **Unique identifier** - Primary key for each embedding record
  </Card>
  <Card title="resourceId" icon="link">
    **Foreign key relation** - Links to the full source material in the
    resources table
  </Card>
</Columns>
<Columns cols={2}>
  <Card title="content" icon="file-text">
    **Plain text chunk** - The actual text content that was chunked
  </Card>
  <Card title="embedding" icon="layers">
    **Vector representation** - The vector representation of the plain text
    chunk
  </Card>
</Columns>

### Indexing for Similarity Search

To perform similarity search, you also need to include an index ([HNSW](https://github.com/pgvector/pgvector?tab=readme-ov-file#hnsw) or [IVFFlat](https://github.com/pgvector/pgvector?tab=readme-ov-file#ivfflat)) on the embedding column for better performance. The schema above includes an HNSW index using cosine similarity operations.

<Info>
  **HNSW Index**: Hierarchical Navigable Small World index for efficient
  approximate nearest neighbor search
</Info>

<Info>
  **Cosine Similarity**: Measures the cosine of the angle between two vectors,
  commonly used for text similarity
</Info>

---

## Update the database

To push this change to the database, run the following command:

```bash terminal
pnpm db:push
```

<Warning>
  This command will create the new embeddings table in your database. Make sure
  your database is running and accessible.
</Warning>

## Check the database

Check that your database has the new `embeddings` table as explained in the[Verify Database Setup](/learning-paths/rag-chatbot/module-2-2#verify-database-setup) section.
