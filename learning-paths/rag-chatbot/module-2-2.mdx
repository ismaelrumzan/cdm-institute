---
title: "2.2 Database Setup"
description: "Create a Postgres database with Vercel and configure environment variables for the RAG application."
---

import { AIPromptReflection } from "/snippets/ai-prompt-reflection.jsx";

## Prerequisites

<Info>
  **Recommended**: Use Cursor's integrated terminal for all command-line
  operations in the course. This provides a seamless development experience with
  your code editor.
</Info>

### Opening Cursor's Terminal

You can open the terminal in Cursor in several ways:

<AccordionGroup>

<Accordion title="Option 1: Using the menu">

1. Go to `Terminal` → `New Terminal` in the top menu

</Accordion>

<Accordion title="Option 2: Using keyboard shortcut">

- **macOS**: `Ctrl + `` (backtick)
- **Windows/Linux**: `Ctrl + `` (backtick)

</Accordion>

<Accordion title="Option 3: Using the command palette">

1. Press `Cmd/Ctrl + Shift + P` to open the command palette
2. Type "Terminal: Create New Terminal"
3. Press Enter

</Accordion>

</AccordionGroup>

<Info>
  **Terminal Location**: The terminal will appear at the bottom of your Cursor
  window. You can resize it by dragging the top edge.
</Info>

---

## Learning Objectives

By the end of this section, you will be able to:

- Create a free Postgres database using Vercel's Neon integration
- Configure environment variables for database connection
- Set up OpenAI API key for embeddings and chat functionality
- Run database migrations to create the initial schema

<Callout>**Duration**: 30 minutes</Callout>

---

## Create Database

You will need a Postgres database to complete this tutorial. We'll use Vercel's Neon integration to create a free Postgres database.

<Info>
  **Why Vercel + Neon?**: This combination provides a free, production-ready
  PostgreSQL database with pgvector support, perfect for RAG applications.
</Info>

---

## Setting up Postgres with Vercel

<Info>
  **Need a Vercel account?** If you don't have a Vercel account yet, follow the
  [Getting Started with
  Vercel](https://vercel.com/docs/getting-started-with-vercel) guide to create
  one first.
</Info>

<Steps>

<Step title="Navigate to Vercel">

1. Go to [Vercel.com](https://vercel.com) and make sure you're logged in
2. Navigate to your team homepage
3. Click on the **Integrations** tab

</Step>

<Step title="Browse the Marketplace">

1. Click **Browse Marketplace**
2. Search for `Neon` in the search bar
3. Click on **Neon** and click **Install**

</Step>

<Step title="Create Database">

1. On the "Get Started with Neon" page, select your region (e.g., Washington, D.C., U.S. East) - select a region close to where the majority of your users are located
2. Turn off **Auth** (for this tutorial)
3. Click **Continue**
4. Name your database (you can use the default name or rename it to something like "RagTutorial")
5. Click **Create** in the bottom right corner

</Step>

<Step title="Get Connection String">

1. After seeing "Database created successfully", click **Done**
2. You'll be redirected to your database instance
3. In the **Quick Start** section, click **Show secrets** in `.env.local`
4. Copy the full **DATABASE_URL** environment variable

<Info>
  **Save this URL**: You'll need this connection string for your environment
  variables in the next step.
</Info>

</Step>

</Steps>

---

## Configure Environment Variables

Now that you have your database, you need to add the connection string as an environment variable.

<Steps>

<Step title="Create Environment File">

Make a copy of the `.env.example` file and rename it to `.env`:

**Option 1: Using the command line**

```bash Terminal
cp .env.example .env
```

**Option 2: Using Cursor's file manager**

1. In the file explorer (left sidebar), right-click on `.env.example`
2. Select `Copy` from the context menu
3. Right-click in the file explorer area
4. Select `Paste` from the context menu
5. Rename the copied file from `.env.example (copy)` to `.env`

</Step>

<Step title="Configure Database URL">

1. Open the new `.env` file
2. You should see an item called `DATABASE_URL`
3. Copy in your database connection string after the equals sign

```env .env
DATABASE_URL=postgresql://username:password@host:port/database
```

</Step>

<Step title="Add OpenAI API Key">

1. Go to [platform.openai.com](https://platform.openai.com) and sign in to your account
2. Click on the Settings gear icon <Icon icon="settings" /> in the top right corner
3. Select **"API Keys"** on the left side bar
4. Click **"Create new secret key"**
5. Give your API key a name (e.g., "RAG Tutorial") and select the **Default project**
6. Click **"Create secret key"**
7. **Important**: Copy the API key immediately - you won't be able to see it again
8. Once you have your API key, paste it into your `.env` file:

```env .env
OPENAI_API_KEY=sk-your-openai-api-key-here
DATABASE_URL=postgresql://username:password@host:port/database
```

</Step>

</Steps>

<Warning>
  **Security**: Never commit your `.env` file to version control. It's already
  in `.gitignore` for safety.
</Warning>

---

## Migrate Database

Once you have your Postgres database and environment variables set up, you can run your first database migration.

<Steps>

<Step title="Run Migration">

Run the following command to set up your database schema in your terminal:

<CodeGroup>

```bash npm
npm run db:migrate
```

```bash pnpm
pnpm db:migrate
```

```bash yarn
yarn db:migrate
```

</CodeGroup>

You should see the following output:

```bash Terminal
⏳ Running migrations...
✅ Migrations completed in 1986 ms

```

</Step>

<Step title="What Happens">

This command will:

1. First add the **pgvector** extension to your database
2. Then create a new table for your resources schema that is defined in `lib/db/schema/resources.ts`
3. This schema has four columns: `id`, `content`, `createdAt`, and `updatedAt`

</Step>

</Steps>

<Info>
  **pgvector Extension**: This extension enables PostgreSQL to store and query
  vector embeddings, which is essential for RAG functionality.
</Info>

---

## Verify Database Setup

<Steps>

<Step title="Check Migration Success">

1. Look for success messages in your terminal
2. You should see output indicating that the pgvector extension was added and tables were created

</Step>

<Step title="Optional: View Database">

You have two options to view your database:

**Option 1: Drizzle Studio (Local)**

Run this command in your terminal:

<CodeGroup>

```bash npm
npm run db:studio
```

```bash pnpm
pnpm db:studio
```

```bash yarn
yarn db:studio
```

</CodeGroup>

You should see the following at the end of the console output:

```bash Terminal
Drizzle Studio is up and running on https://local.drizzle.studio

```

Open the link in your browser to see a web interface where you can see your database tables.

**Option 2: Vercel Dashboard (Cloud)**

1. Go to your [Vercel Dashboard](https://vercel.com/dashboard)
2. Navigate to the **Storage** tab
3. Find your Neon database and click on it
4. Click on the **Open in Neon** button to view your database in Neon console
5. Click **Tables** on the left sidebar. You should see a **Resources** table with 4 columns: `id`, `content`, `createdAt`, and `updatedAt` with no data

<Info>
  **Both options work**: Drizzle Studio is great for local development, while
  the Vercel dashboard is convenient for viewing your cloud database directly.
</Info>

</Step>

</Steps>

---

## Troubleshooting

<AccordionGroup>

<Accordion title="Migration fails with connection errors">

**Possible causes and solutions:**

1. **Check your DATABASE_URL format** - Ensure it follows the pattern: `postgresql://username:password@host:port/database`

2. **Verify your database is running** - Check your Vercel dashboard to ensure the database is active

3. **Check network connectivity** - Ensure your local machine can reach the database host

4. **Verify credentials** - Double-check the username and password in your connection string

</Accordion>

<Accordion title="pgvector extension fails to install">

**This is usually resolved by:**

1. **Using Neon database** - Neon comes with pgvector pre-installed
2. **Checking database permissions** - Ensure your database user has CREATE EXTENSION privileges
3. **Contacting support** - If using a different provider, check their pgvector support

</Accordion>

</AccordionGroup>

---

## Reflection Questions

Take a moment to reflect on what you've learned. Think about it first and then use AI to refine your answers.

<AIPromptReflection
  question="Why is a cloud database beneficial for this tutorial? Consider accessibility, scalability, and pgvector support, as well as deployment and collaboration."
  chatgptButtonText="Ask ChatGPT"
  claudeButtonText="Ask Claude"
  cardTitle="Cloud Database"
/>

<AIPromptReflection
  question="What role does the pgvector extension play in RAG applications? Consider vector storage and similarity search capabilities, as well as performance and functionality."
  chatgptButtonText="Ask ChatGPT"
  claudeButtonText="Ask Claude"
  cardTitle="pgvector Extension"
/>

<AIPromptReflection
  question="How do environment variables help with security and configuration? Consider credential management and deployment flexibility, as well as development vs production environments."
  chatgptButtonText="Ask ChatGPT"
  claudeButtonText="Ask Claude"
  cardTitle="Environment Variables"
/>
